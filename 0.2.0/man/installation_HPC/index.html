<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Installation on HPC systems · LaMEM.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LaMEM.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../installation/">General instructions</a></li><li class="is-active"><a class="tocitem" href>Installation on HPC systems</a></li></ul></li><li><span class="tocitem">Create &amp; run LaMEM models from julia</span><ul><li><a class="tocitem" href="../juliasetups/">Overview</a></li><li><a class="tocitem" href="../juliasetup_example_sphere/">Example 1: Sphere</a></li><li><a class="tocitem" href="../juliasetup_LaPalma/">Example 2: Volcano</a></li><li><a class="tocitem" href="../juliasetup_pluto/">Pluto notebooks</a></li><li><a class="tocitem" href="../LaMEM_ModelFunctions/">Available functions</a></li></ul></li><li><a class="tocitem" href="../runlamem/">Run LaMEM</a></li><li><a class="tocitem" href="../readtimesteps/">Reading timesteps</a></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Installation</a></li><li class="is-active"><a href>Installation on HPC systems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Installation on HPC systems</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGeodynamics/LaMEM.jl/blob/main/docs/src/man/installation_HPC.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Installation-on-HPC-systems"><a class="docs-heading-anchor" href="#Installation-on-HPC-systems">Installation on HPC systems</a><a id="Installation-on-HPC-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-on-HPC-systems" title="Permalink"></a></h1><p>Installing LaMEM on high performance computer (HPC) systems can be complicated, because you will have to compile PETSc with the correct dependencies for that system.  The reason is that HPC systems use MPI versions that are specifically tailored/compiled for that system. </p><p>Luckily there is a solution thanks to the great work of <code>@eschnett</code> and colleagues, who developed <a href="https://github.com/eschnett/MPItrampoline">MPITrampoline</a> which is an intermediate layer between the HPC-system-specific MPI libraries and the precompiled <code>LaMEM</code> binaries. </p><p>It essentially consists of two steps:      1) compile a small package (<a href="https://github.com/eschnett/MPIwrapper">MPIwrapper</a>)      2) make sure that you download the version of <code>MAGEMin</code> that was compiled versus <code>MPItrampoline</code>.</p><p>Here step-by-step instructions (for Linux, as that is what essentially all HPC systems use):</p><ul><li>Download <a href="https://github.com/eschnett/MPIwrapper">MPIwrapper</a>: </li></ul><pre><code class="language-bash hljs">$git clone https://github.com/eschnett/MPIwrapper.git 
$cd MPIwrapper</code></pre><ul><li>Install it after making sure that <code>mpiexec</code> points to the one you want (you may have to load some modules, depending on your system):</li></ul><pre><code class="language-bash hljs">$cmake -S . -B build -DMPIEXEC_EXECUTABLE=mpiexec -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_INSTALL_PREFIX=$HOME/mpiwrapper
$cmake --build build
$cmake --install build</code></pre><p>At this stage, <code>MPItrampoline</code> is installed in <code>$HOME/mpiwrapper</code></p><ul><li>Set the correct wrapper:</li></ul><pre><code class="nohighlight hljs">$export MPITRAMPOLINE_LIB=$HOME/mpiwrapper/lib64/libmpiwrapper.so</code></pre><p>Depending on the system it may be called <code>lib</code> instead of <code>lib64</code> (check!).</p><ul><li>Start julia and install the <code>MPI</code> and <code>MPIPreferences</code> packages:</li></ul><pre><code class="language-julia hljs">$julia
julia&gt; ]
pkg&gt;add MPI, MPIPreferences</code></pre><ul><li>Set the preference to use <code>MPItrampoline</code></li></ul><pre><code class="language-julia hljs">julia&gt; using MPIPreferences; MPIPreferences.use_jll_binary(&quot;MPItrampoline_jll&quot;)
┌ Info: MPIPreferences unchanged
└   binary = &quot;MPItrampoline_jll&quot;</code></pre><ul><li>Load <code>MPI</code> and verify it is the correct one</li></ul><pre><code class="language-julia hljs">julia&gt; using MPI
julia&gt; MPI.Get_library_version()
&quot;MPIwrapper 2.10.3, using MPIABI 2.9.0, wrapping:\nOpen MPI v4.1.4, package: Open MPI boris@Pluton Distribution, ident: 4.1.4, repo rev: v4.1.4, May 26, 2022&quot;</code></pre><p>After this, restart julia (this only needs to be done once, next time all is fine).</p><ul><li>Now load <code>LaMEM</code> and check that it uses the <code>mpitrampoline</code> version:</li></ul><pre><code class="language-julia hljs">julia&gt; using MPI,LaMEM
julia&gt; LaMEM.LaMEM_jll.host_platform
Linux x86_64 {cxxstring_abi=cxx11, julia_version=1.8.1, libc=glibc, libgfortran_version=5.0.0, mpi=mpitrampoline}</code></pre><p>At this stage the precompiled version of <code>LaMEM</code> should be useable on that system.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« General instructions</a><a class="docs-footer-nextpage" href="../juliasetups/">Overview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 20 July 2023 20:04">Thursday 20 July 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
