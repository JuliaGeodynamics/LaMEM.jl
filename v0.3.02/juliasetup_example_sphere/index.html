<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example 1: Sphere · LaMEM.jl</title><meta name="title" content="Example 1: Sphere · LaMEM.jl"/><meta property="og:title" content="Example 1: Sphere · LaMEM.jl"/><meta property="twitter:title" content="Example 1: Sphere · LaMEM.jl"/><meta name="description" content="Documentation for LaMEM.jl."/><meta property="og:description" content="Documentation for LaMEM.jl."/><meta property="twitter:description" content="Documentation for LaMEM.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LaMEM.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../installation/">General instructions</a></li><li><a class="tocitem" href="../installation_HPC/">Installation on HPC systems</a></li></ul></li><li><span class="tocitem">Create &amp; run LaMEM models from julia</span><ul><li><a class="tocitem" href="../juliasetups/">Overview</a></li><li class="is-active"><a class="tocitem" href>Example 1: Sphere</a></li><li><a class="tocitem" href="../juliasetup_LaPalma/">Example 2: Volcano</a></li><li><a class="tocitem" href="../juliasetup_TMSubduction/">Example 3: 2D Subduction</a></li><li><a class="tocitem" href="../Subduction3D/">Example 4: 3D Subduction</a></li><li><a class="tocitem" href="../juliasetup_pluto/">Notebooks</a></li><li><a class="tocitem" href="../LaMEM_ModelFunctions/">Available functions</a></li></ul></li><li><a class="tocitem" href="../runlamem/">Run LaMEM</a></li><li><a class="tocitem" href="../readtimesteps/">Reading timesteps</a></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Create &amp; run LaMEM models from julia</a></li><li class="is-active"><a href>Example 1: Sphere</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example 1: Sphere</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGeodynamics/LaMEM.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaGeodynamics/LaMEM.jl/blob/main/docs/src/juliasetup_example_sphere.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="1.-Example-1:-Falling-sphere"><a class="docs-heading-anchor" href="#1.-Example-1:-Falling-sphere">1. Example 1: Falling sphere</a><a id="1.-Example-1:-Falling-sphere-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Example-1:-Falling-sphere" title="Permalink"></a></h1><p>This is a first example that illustrates how to build a setup using the LaMEM.jl package, run it and visualize the results, all without leaving julia.</p><p>We start with loading the packages we need:</p><pre><code class="language-julia hljs">julia&gt; using LaMEM, GeophysicalModelGenerator, Plots</code></pre><p>The <a href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl">GeophysicalModelGenerator</a> package can be used to generate model setups and <a href="https://github.com/JuliaPlots/Plots.jl">Plots</a> for plotting.</p><h4 id="1.1-Define-model-setup"><a class="docs-heading-anchor" href="#1.1-Define-model-setup">1.1 Define model setup</a><a id="1.1-Define-model-setup-1"></a><a class="docs-heading-anchor-permalink" href="#1.1-Define-model-setup" title="Permalink"></a></h4><p>Next, we define a general model setup, in which we specify the units with which we work (for most cases, you&#39;ll want to use the default <code>GEO</code> units), the size of the computational box and various timestepping parameters. In this case, we use a multigrid solver.</p><pre><code class="language-julia hljs">julia&gt; model  = Model(Grid(nel=(16,16,16), x=[-1,1], y=[-1,1], z=[-1,1]), 
          Time(nstep_max=20, dt_min=1e-3, dt=1, dt_max=10, time_end=100), 
          Solver(SolverType=&quot;multigrid&quot;, MGLevels=2),
          Output(out_dir=&quot;example_1&quot;))
LaMEM Model setup
|
|-- Scaling             :  GeoParams.Units.GeoUnits{GEO}
|-- Grid                :  nel=(16, 16, 16); xϵ(-1.0, 1.0), yϵ(-1.0, 1.0), zϵ(-1.0, 1.0) 
|-- Time                :  nstep_max=20; nstep_out=1; time_end=100.0; dt=1.0
|-- Boundary conditions :  noslip=[0, 0, 0, 0, 0, 0]
|-- Solution parameters :  eta_min=1.0e18; eta_max=1.0e25; eta_ref=1.0e20; act_temp_diff=0
|-- Solver options      :  multigrid solver; coarse grid solver=direct; 2 levels
|-- Model setup options :  Type=files; 
|-- Output options      :  filename=output; pvd=1; avd=0; surf=0
|-- Materials           :  0 phases; </code></pre><p>Note that each of the fields within <code>Model</code> has many additional and adjustable parameters. You can view that by typing:</p><pre><code class="language-julia hljs">julia&gt; model.Time
LaMEM Timestepping parameters: 
  time_end        = 100.0 
  dt              = 1.0 
  dt_min          = 0.001 
  dt_max          = 10.0 
  dt_out          = 0.2 
  inc_dt          = 0.1 
  CFL             = 0.5 
  CFLMAX          = 0.8 
  nstep_max       = 20 
  nstep_out       = 1 
  nstep_rdb       = 100 
  nstep_ini       = 1 
  time_tol        = 1.0e-8 </code></pre><h4 id="1.2-Specify-material-properties"><a class="docs-heading-anchor" href="#1.2-Specify-material-properties">1.2 Specify material properties</a><a id="1.2-Specify-material-properties-1"></a><a class="docs-heading-anchor-permalink" href="#1.2-Specify-material-properties" title="Permalink"></a></h4><p>Once this is specified, we need to set material properties for each of the <code>Phases</code> we will consider in the simulation. This can be done with the <code>Phase</code> structure. First, we define two phases</p><pre><code class="language-julia hljs">julia&gt; rm_phase!(model)
julia&gt; matrix = Phase(ID=0,Name=&quot;matrix&quot;,eta=1e20,rho=3000)
Phase 0 (matrix): 
  rho    = 3000.0 
  eta    = 1.0e20 
julia&gt; sphere = Phase(ID=1,Name=&quot;sphere&quot;,eta=1e23,rho=3200)
Phase 1 (sphere): 
  rho    = 3200.0 
  eta    = 1.0e23 </code></pre><p>and add them to the model with:</p><pre><code class="language-julia hljs">julia&gt; add_phase!(model, sphere, matrix)</code></pre><h4 id="1.3-Set-initial-model-geometry"><a class="docs-heading-anchor" href="#1.3-Set-initial-model-geometry">1.3 Set initial model geometry</a><a id="1.3-Set-initial-model-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#1.3-Set-initial-model-geometry" title="Permalink"></a></h4><p>We also need to specify an initial model geometry. The julia package <code>GeophysicalModelGenerator</code> has a number of functions for that, which can be used here. For the current setup, we just add a sphere: </p><pre><code class="language-julia hljs">julia&gt; add_sphere!(model,cen=(0.0,0.0,0.0), radius=(0.5, ))</code></pre><p>It is often useful to plot the initial model setup. You can do this with the <code>heatmap</code> function from the <code>Plots.jl</code> package, for which we provide a LaMEM plugin that allows you to specify a cross-section through a 3D LaMEM setup:</p><pre><code class="language-julia hljs">julia&gt; plot_cross_section(model, field=:phase, y=0)</code></pre><p><img src="../assets/InitialSetupSphere.png" alt="InitialSetupSphere"/></p><p>In the initial setup we define two fields: <code>:phase</code> which defines the rocktypes and <code>:temperature</code> which has the initial temperature. They are stored as 3D arrays in <code>model.Grid.Phases</code> and <code>model.Grid.Temp</code>:</p><pre><code class="language-julia hljs">julia&gt; model.Grid
LaMEM grid with constant Δ: 
  nel         : ([16], [16], [16])
  marker/cell : (3, 3, 3)
  x           ϵ [-1.0 : 1.0]
  y           ϵ [-1.0 : 1.0]
  z           ϵ [-1.0 : 1.0]
  Phases      : range ϵ [0 - 1]
  Temp        : range ϵ [0.0 - 0.0]</code></pre><h4 id="1.4-Run-LaMEM"><a class="docs-heading-anchor" href="#1.4-Run-LaMEM">1.4 Run LaMEM</a><a id="1.4-Run-LaMEM-1"></a><a class="docs-heading-anchor-permalink" href="#1.4-Run-LaMEM" title="Permalink"></a></h4><p>At this stage we are ready to run a LaMEM simulation which can simply be done with the <code>run_lamem</code> command. By default, it will run on one processor. If you want to run this in parallel, you can specify the number of cores you want to use. Please note that running things in parallel is only worth the effort for large resolutions; for smaller setups it will be faster on one processor:</p><pre><code class="language-julia hljs">julia&gt; run_lamem(model,1)
Saved file: Model3D.vts
Writing LaMEM marker file -&gt; ./markers/mdb.00000000.dat
-------------------------------------------------------------------------- 
                   Lithosphere and Mantle Evolution Model                   
     Compiled: Date: Apr  7 2023 - Time: 22:11:23           
     Version : 1.2.4 
-------------------------------------------------------------------------- 
        STAGGERED-GRID FINITE DIFFERENCE CANONICAL IMPLEMENTATION           
-------------------------------------------------------------------------- 
Parsing input file : output.dat 
Finished parsing input file : output.dat 
--------------------------------------------------------------------------
Scaling parameters:
   Temperature : 1000. [C/K] 
   Length      : 1e+06 [m] 
   Viscosity   : 1e+20 [Pa*s] 
   Stress      : 10. [Pa] 
--------------------------------------------------------------------------
Time stepping parameters:
   Simulation end time          : 100. [Myr] 
   Maximum number of steps      : 20 
   Time step                    : 1. [Myr] 
   Minimum time step            : 0.001 [Myr] 
   Maximum time step            : 10. [Myr] 
   Time step increase factor    : 0.1 
   CFL criterion                : 0.5 
   CFLMAX (fixed time steps)    : 0.8 
   Output every [n] steps       : 1 
   Output [n] initial steps     : 1 
--------------------------------------------------------------------------
--------------------------------------------------------------------------</code></pre><h4 id="1.5-Visualize-results"><a class="docs-heading-anchor" href="#1.5-Visualize-results">1.5 Visualize results</a><a id="1.5-Visualize-results-1"></a><a class="docs-heading-anchor-permalink" href="#1.5-Visualize-results" title="Permalink"></a></h4><p>Once the simulation is done, you can look at the results using the same <code>heatmap</code> function, but by specifying a timestep, which will read that timestep and plot a cross-section though it:</p><pre><code class="language-julia hljs">julia&gt; plot_cross_section(model, y=0, timestep=20, field=:phase)	</code></pre><p><img src="../assets/FallingSphere_t20.png" alt="FallingSphere_t20"/></p><p>Alternatively, you can visualize the results with Paraview. Change to the directory where you did the simulation:</p><pre><code class="language-julia hljs">julia&gt; cd(model.Output.out_dir)
julia&gt; julia&gt; readdir()
25-element Vector{String}:
 &quot;Model3D.vts&quot;
 &quot;Timestep_00000000_0.00000000e+00&quot;
 &quot;Timestep_00000001_1.10000000e+00&quot;
 &quot;Timestep_00000002_2.31000000e+00&quot;
 &quot;Timestep_00000003_3.64100000e+00&quot;
 &quot;Timestep_00000004_5.10510000e+00&quot;
 &quot;Timestep_00000005_6.71561000e+00&quot;
 ⋮
 &quot;Timestep_00000017_4.45991731e+01&quot;
 &quot;Timestep_00000018_5.01590904e+01&quot;
 &quot;Timestep_00000019_5.62749995e+01&quot;
 &quot;Timestep_00000020_6.30024994e+01&quot;
 &quot;markers&quot;
 &quot;output.dat&quot;
 &quot;output.pvd&quot;</code></pre><p>And you can open <code>output.pvd</code> with paraview. If your system recognizes that <code>*.pvd</code> files should be opened with paraview, you can do that with</p><pre><code class="language-julia hljs">julia&gt; ;
shell&gt; open output.pvd</code></pre><p>Otherwise, start paraview manually and open the file.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../juliasetups/">« Overview</a><a class="docs-footer-nextpage" href="../juliasetup_LaPalma/">Example 2: Volcano »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 15 March 2024 06:44">Friday 15 March 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
